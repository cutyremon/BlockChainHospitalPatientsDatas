{"ast":null,"code":"'use strict';\n\nvar waterfall = require('async/waterfall');\n\nvar Message = require('../../message');\n\nvar utils = require('../../utils');\n\nmodule.exports = function (dht) {\n  var log = utils.logger(dht.peerInfo.id, 'rpc:find-node');\n  /**\n   * Process `FindNode` DHT messages.\n   *\n   * @param {PeerInfo} peer\n   * @param {Message} msg\n   * @param {function(Error, Message)} callback\n   * @returns {undefined}\n   */\n\n  return function findNode(peer, msg, callback) {\n    log('start');\n    waterfall([function (cb) {\n      if (msg.key.equals(dht.peerInfo.id.id)) {\n        return cb(null, [dht.peerInfo]);\n      }\n\n      dht._betterPeersToQuery(msg, peer, cb);\n    }, function (closer, cb) {\n      var response = new Message(msg.type, Buffer.alloc(0), msg.clusterLevel);\n\n      if (closer.length > 0) {\n        response.closerPeers = closer;\n      } else {\n        log('handle FindNode %s: could not find anything', peer.id.toB58String());\n      }\n\n      cb(null, response);\n    }], callback);\n  };\n};","map":null,"metadata":{},"sourceType":"script"}