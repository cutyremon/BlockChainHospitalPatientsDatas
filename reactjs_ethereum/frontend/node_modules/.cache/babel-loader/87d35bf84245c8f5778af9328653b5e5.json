{"ast":null,"code":"function abortable(onEnd) {\n  var aborted = false,\n      reading = false,\n      ended = false,\n      _cb,\n      _read;\n\n  function doEnd() {\n    if (!onEnd) return;\n    if (aborted && aborted !== true) return onEnd(aborted);\n    if (ended && ended !== true) return onEnd(ended);\n    return onEnd(null);\n  }\n\n  function terminate(err) {\n    doEnd();\n    var cb = _cb;\n    _cb = null;\n    if (cb) cb(aborted || ended);\n  }\n\n  function cancel() {\n    ended = ended || true;\n    terminate(aborted || ended);\n    if (_read) _read(aborted, function (err) {\n      if (_cb) _cb(err || aborted);\n    });\n  }\n\n  function reader(read) {\n    _read = read;\n    return function (abort, cb) {\n      _cb = cb;\n      if (abort) aborted = abort;\n      if (ended) return cb(ended);\n      if (aborted) return;\n      reading = true;\n      read(abort, function (end, data) {\n        reading = false;\n        if (aborted) return !abort && read(aborted, function () {});\n        if (!_cb) return;\n        var cb = _cb;\n        _cb = null;\n\n        if (end) {\n          ended = aborted || end;\n          doEnd();\n          cb(aborted || end);\n        } else {\n          cb(aborted || end, data);\n        }\n      });\n    };\n  }\n\n  reader.abort = function (err) {\n    if (ended) return;\n    aborted = err || true;\n    cancel();\n  };\n\n  return reader;\n}\n\nmodule.exports = abortable;","map":null,"metadata":{},"sourceType":"script"}