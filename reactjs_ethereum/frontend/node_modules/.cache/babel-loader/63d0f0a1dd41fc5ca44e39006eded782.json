{"ast":null,"code":"'use strict';\n\nvar _require = require('datastore-core'),\n    TieredDatastore = _require.TieredDatastore;\n\nvar get = require('dlv');\n\nvar PubsubDatastore = require('./pubsub-datastore');\n\nvar OfflineDatastore = require('./offline-datastore');\n\nmodule.exports = function (ipfs) {\n  // Setup online routing for IPNS with a tiered routing composed by a DHT and a Pubsub router (if properly enabled)\n  var ipnsStores = []; // Add IPNS pubsub if enabled\n\n  var pubsubDs;\n\n  if (get(ipfs._options, 'EXPERIMENTAL.ipnsPubsub', false)) {\n    var pubsub = ipfs.libp2p.pubsub;\n    var localDatastore = ipfs._repo.datastore;\n    var peerId = ipfs._peerInfo.id;\n    pubsubDs = new PubsubDatastore(pubsub, localDatastore, peerId);\n    ipnsStores.push(pubsubDs);\n  } // DHT should not be added as routing if we are offline or it is disabled\n\n\n  if (get(ipfs._options, 'offline') || !get(ipfs._options, 'libp2p.dht.enabled', false)) {\n    var offlineDatastore = new OfflineDatastore(ipfs._repo);\n    ipnsStores.push(offlineDatastore);\n  } else {\n    ipnsStores.push(ipfs.libp2p.dht);\n  } // Create ipns routing with a set of datastores\n\n\n  return new TieredDatastore(ipnsStores);\n};","map":null,"metadata":{},"sourceType":"script"}