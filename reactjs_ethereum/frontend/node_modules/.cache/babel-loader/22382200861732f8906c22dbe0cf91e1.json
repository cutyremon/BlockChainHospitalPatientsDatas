{"ast":null,"code":"'use strict';\n\nvar _regeneratorRuntime = require(\"/home/cutyremon/blockChain/reactjs_ethereum/frontend/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/home/cutyremon/blockChain/reactjs_ethereum/frontend/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar mkdir = require('./mkdir');\n\nvar log = require('debug')('ipfs:mfs:cp');\n\nvar errCode = require('err-code');\n\nvar updateTree = require('./utils/update-tree');\n\nvar updateMfsRoot = require('./utils/update-mfs-root');\n\nvar addLink = require('./utils/add-link');\n\nvar applyDefaultOptions = require('./utils/apply-default-options');\n\nvar toMfsPath = require('./utils/to-mfs-path');\n\nvar toSourcesAndDestination = require('./utils/to-sources-and-destination');\n\nvar toTrail = require('./utils/to-trail');\n\nvar defaultOptions = {\n  parents: false,\n  flush: true,\n  format: 'dag-pb',\n  hashAlg: 'sha2-256',\n  cidVersion: 0,\n  shardSplitThreshold: 1000\n};\n\nmodule.exports = function (context) {\n  return (\n    /*#__PURE__*/\n    function () {\n      var _mfsCp = _asyncToGenerator(\n      /*#__PURE__*/\n      _regeneratorRuntime.mark(function _callee() {\n        var _len,\n            args,\n            _key,\n            options,\n            _ref,\n            sources,\n            destination,\n            missing,\n            destinationIsDirectory,\n            destinationPath,\n            trail,\n            source,\n            destinationName,\n            _args = arguments;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                for (_len = _args.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n                  args[_key] = _args[_key];\n                }\n\n                options = applyDefaultOptions(args, defaultOptions);\n                _context.next = 4;\n                return toSourcesAndDestination(context, args);\n\n              case 4:\n                _ref = _context.sent;\n                sources = _ref.sources;\n                destination = _ref.destination;\n\n                if (sources.length) {\n                  _context.next = 9;\n                  break;\n                }\n\n                throw errCode(new Error('Please supply at least one source'), 'ERR_INVALID_PARAMS');\n\n              case 9:\n                if (destination) {\n                  _context.next = 11;\n                  break;\n                }\n\n                throw errCode(new Error('Please supply a destination'), 'ERR_INVALID_PARAMS');\n\n              case 11:\n                options.parents = options.p || options.parents; // make sure all sources exist\n\n                missing = sources.find(function (source) {\n                  return !source.exists;\n                });\n\n                if (!missing) {\n                  _context.next = 15;\n                  break;\n                }\n\n                throw errCode(new Error(\"\".concat(missing.path, \" does not exist\")), 'ERR_INVALID_PARAMS');\n\n              case 15:\n                destinationIsDirectory = isDirectory(destination);\n\n                if (!destination.exists) {\n                  _context.next = 22;\n                  break;\n                }\n\n                log('Destination exists');\n\n                if (!(sources.length === 1 && !destinationIsDirectory)) {\n                  _context.next = 20;\n                  break;\n                }\n\n                throw errCode(new Error('directory already has entry by that name'), 'ERR_ALREADY_EXISTS');\n\n              case 20:\n                _context.next = 31;\n                break;\n\n              case 22:\n                log('Destination does not exist');\n\n                if (!(sources.length > 1)) {\n                  _context.next = 31;\n                  break;\n                }\n\n                if (options.parents) {\n                  _context.next = 26;\n                  break;\n                }\n\n                throw errCode(new Error('destination did not exist, pass -p to create intermediate directories'), 'ERR_INVALID_PARAMS');\n\n              case 26:\n                _context.next = 28;\n                return mkdir(context)(destination.path, options);\n\n              case 28:\n                _context.next = 30;\n                return toMfsPath(context, destination.path);\n\n              case 30:\n                destination = _context.sent;\n\n              case 31:\n                destinationPath = isDirectory(destination) ? destination.mfsPath : destination.mfsDirectory;\n                _context.next = 34;\n                return toTrail(context, destinationPath, options);\n\n              case 34:\n                trail = _context.sent;\n\n                if (!(sources.length === 1)) {\n                  _context.next = 40;\n                  break;\n                }\n\n                source = sources.pop();\n                destinationName = destinationIsDirectory ? source.name : destination.name;\n                log(\"Only one source, copying to destination \".concat(destinationIsDirectory ? 'directory' : 'file', \" \").concat(destinationName));\n                return _context.abrupt(\"return\", copyToFile(context, source, destinationName, trail, options));\n\n              case 40:\n                log('Multiple sources, wrapping in a directory');\n                return _context.abrupt(\"return\", copyToDirectory(context, sources, destination, trail, options));\n\n              case 42:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      function mfsCp() {\n        return _mfsCp.apply(this, arguments);\n      }\n\n      return mfsCp;\n    }()\n  );\n};\n\nvar isDirectory = function isDirectory(destination) {\n  return destination.unixfs && destination.unixfs.type && destination.unixfs.type.includes('directory');\n};\n\nvar copyToFile =\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee2(context, source, destination, destinationTrail, options) {\n    var parent, newRootCid;\n    return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            parent = destinationTrail.pop();\n            _context2.next = 3;\n            return addSourceToParent(context, source, destination, parent, options);\n\n          case 3:\n            parent = _context2.sent;\n            // update the tree with the new containg directory\n            destinationTrail.push(parent);\n            _context2.next = 7;\n            return updateTree(context, destinationTrail, options);\n\n          case 7:\n            newRootCid = _context2.sent;\n            _context2.next = 10;\n            return updateMfsRoot(context, newRootCid);\n\n          case 10:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n\n  return function copyToFile(_x, _x2, _x3, _x4, _x5) {\n    return _ref2.apply(this, arguments);\n  };\n}();\n\nvar copyToDirectory =\n/*#__PURE__*/\nfunction () {\n  var _ref3 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee3(context, sources, destination, destinationTrail, options) {\n    var i, source, newRootCid;\n    return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            i = 0;\n\n          case 1:\n            if (!(i < sources.length)) {\n              _context3.next = 9;\n              break;\n            }\n\n            source = sources[i];\n            _context3.next = 5;\n            return addSourceToParent(context, source, source.name, destination, options);\n\n          case 5:\n            destination = _context3.sent;\n\n          case 6:\n            i++;\n            _context3.next = 1;\n            break;\n\n          case 9:\n            // update the tree with the new containg directory\n            destinationTrail[destinationTrail.length - 1] = destination;\n            _context3.next = 12;\n            return updateTree(context, destinationTrail, options);\n\n          case 12:\n            newRootCid = _context3.sent;\n            _context3.next = 15;\n            return updateMfsRoot(context, newRootCid);\n\n          case 15:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n\n  return function copyToDirectory(_x6, _x7, _x8, _x9, _x10) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nvar addSourceToParent =\n/*#__PURE__*/\nfunction () {\n  var _ref4 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee4(context, source, childName, parent, options) {\n    var sourceBlock, _ref5, node, cid;\n\n    return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return context.repo.blocks.get(source.cid);\n\n          case 2:\n            sourceBlock = _context4.sent;\n            _context4.next = 5;\n            return addLink(context, {\n              parentCid: parent.cid,\n              size: sourceBlock.data.length,\n              cid: source.cid,\n              name: childName,\n              format: options.format,\n              hashAlg: options.hashAlg,\n              cidVersion: options.cidVersion\n            });\n\n          case 5:\n            _ref5 = _context4.sent;\n            node = _ref5.node;\n            cid = _ref5.cid;\n            parent.node = node;\n            parent.cid = cid;\n            parent.size = node.size;\n            return _context4.abrupt(\"return\", parent);\n\n          case 12:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, _callee4);\n  }));\n\n  return function addSourceToParent(_x11, _x12, _x13, _x14, _x15) {\n    return _ref4.apply(this, arguments);\n  };\n}();","map":null,"metadata":{},"sourceType":"script"}