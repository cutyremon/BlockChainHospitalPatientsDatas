{"ast":null,"code":"'use strict';\n\nvar _regeneratorRuntime = require(\"/home/cutyremon/blockChain/reactjs_ethereum/frontend/node_modules/@babel/runtime/regenerator\");\n\nvar _asyncToGenerator = require(\"/home/cutyremon/blockChain/reactjs_ethereum/frontend/node_modules/@babel/runtime/helpers/asyncToGenerator\");\n\nvar Bucket = require('hamt-sharding/src/bucket');\n\nvar DirSharded = require('ipfs-unixfs-importer/src/dir-sharded');\n\nvar addLinksToHamtBucket = function addLinksToHamtBucket(links, bucket, rootBucket) {\n  return Promise.all(links.map(function (link) {\n    if (link.Name.length === 2) {\n      var pos = parseInt(link.Name, 16);\n      return bucket._putObjectAt(pos, new Bucket({\n        hashFn: DirSharded.hashFn\n      }, bucket, pos));\n    }\n\n    return rootBucket.put(link.Name.substring(2), true);\n  }));\n};\n\nvar toPrefix = function toPrefix(position) {\n  return position.toString('16').toUpperCase().padStart(2, '0').substring(0, 2);\n};\n\nvar toBucketPath = function toBucketPath(position) {\n  var bucket = position.bucket;\n  var path = [];\n\n  while (bucket._parent) {\n    path.push(bucket);\n    bucket = bucket._parent;\n  }\n\n  path.push(bucket);\n  return path.reverse();\n};\n\nvar findShardCid =\n/*#__PURE__*/\nfunction () {\n  var _ref = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(node, name, ipld, context) {\n    var position, prefix, bucketPath, link;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            if (!context) {\n              context = {\n                rootBucket: new Bucket({\n                  hashFn: DirSharded.hashFn\n                }),\n                hamtDepth: 1\n              };\n              context.lastBucket = context.rootBucket;\n            }\n\n            _context.next = 3;\n            return addLinksToHamtBucket(node.Links, context.lastBucket, context.rootBucket);\n\n          case 3:\n            _context.next = 5;\n            return context.rootBucket._findNewBucketAndPos(name);\n\n          case 5:\n            position = _context.sent;\n            prefix = toPrefix(position.pos);\n            bucketPath = toBucketPath(position);\n\n            if (bucketPath.length > context.hamtDepth) {\n              context.lastBucket = bucketPath[context.hamtDepth];\n              prefix = toPrefix(context.lastBucket._posAtParent);\n            }\n\n            link = node.Links.find(function (link) {\n              var entryPrefix = link.Name.substring(0, 2);\n              var entryName = link.Name.substring(2);\n\n              if (entryPrefix !== prefix) {\n                // not the entry or subshard we're looking for\n                return;\n              }\n\n              if (entryName && entryName !== name) {\n                // not the entry we're looking for\n                return;\n              }\n\n              return true;\n            });\n\n            if (link) {\n              _context.next = 12;\n              break;\n            }\n\n            return _context.abrupt(\"return\", null);\n\n          case 12:\n            if (!(link.Name.substring(2) === name)) {\n              _context.next = 14;\n              break;\n            }\n\n            return _context.abrupt(\"return\", link.Hash);\n\n          case 14:\n            context.hamtDepth++;\n            _context.next = 17;\n            return ipld.get(link.Hash);\n\n          case 17:\n            node = _context.sent;\n            return _context.abrupt(\"return\", findShardCid(node, name, ipld, context));\n\n          case 19:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function findShardCid(_x, _x2, _x3, _x4) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nmodule.exports = findShardCid;","map":null,"metadata":{},"sourceType":"script"}